<!doctype html><html lang=zh-ch><head><title>使用Github Actions自动编译部署基于的hugo博客 :: 火龙果的博客 — 分享学到的知识</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="在GitHub推出actions功能后，利用GitHub托管博客源码变得更加方便快捷，这里分享一下本站自动化部署的方式。 配置ACTIONS_"><meta name=keywords content="GitHub,Actions,GitHub actions,hugo,ACTIONS_DEPLOY_KEY"><meta name=robots content=noodp><link rel=canonical href=https://yanlong.me/post/deploy-blog-use-github-actions/><link rel=stylesheet href=https://yanlong.me/assets/style.css><link rel=stylesheet href=https://yanlong.me/assets/blue.css><link rel=apple-touch-icon-precomposed sizes=180x180 href=https://yanlong.me/favicon-apple.png><link rel="shortcut icon" href=https://yanlong.me/favicon.png><meta name=twitter:card content=summary><meta name=twitter:title content="使用Github Actions自动编译部署基于的hugo博客 :: 火龙果的博客 — 分享学到的知识"><meta name=twitter:description content="在GitHub推出actions功能后，利用GitHub托管博客源码变得更加方便快捷，这里分享一下本站自动化部署的方式。 配置ACTIONS_"><meta name=twitter:site content=https://yanlong.me/><meta name=twitter:creator content><meta name=twitter:image content><meta property=og:locale content=zh-ch><meta property=og:type content=article><meta property=og:title content="使用Github Actions自动编译部署基于的hugo博客 :: 火龙果的博客 — 分享学到的知识"><meta property=og:description content="在GitHub推出actions功能后，利用GitHub托管博客源码变得更加方便快捷，这里分享一下本站自动化部署的方式。 配置ACTIONS_"><meta property=og:url content=https://yanlong.me/post/deploy-blog-use-github-actions/><meta property=og:site_name content="使用Github Actions自动编译部署基于的hugo博客"><meta property=og:image content><meta property=og:image:width content=2048><meta property=og:image:height content=1024><meta property=article:published_time content="2019-11-15 16:51:03 &#43;0800 &#43;0800"><link rel=stylesheet href=/assets/github.min.css><script src=/assets/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script data-ad-client=ca-pub-4136853851848129 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-124887845-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-124887845-1');</script></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=https://yanlong.me/><div class=logo>火龙果的博客</div></a></div><div class=menu-trigger>menu</div></div></header><div class=content><div class=post><h1 class=post-title><a href=https://yanlong.me/post/deploy-blog-use-github-actions/>使用Github Actions自动编译部署基于的hugo博客</a></h1><div class=post-meta><span class=post-date>2019-11-15</span></div><span class=post-tags>#<a href=https://yanlong.me/tags/github/>github</a>&nbsp;</span><div class=post-content><p>在GitHub推出actions功能后，利用GitHub托管博客源码变得更加方便快捷，这里分享一下本站自动化部署的方式。</p><h2 id=配置-actions-deploy-key>配置<code>ACTIONS_DEPLOY_KEY</code></h2><p>由于actions部署阶段需要进行代码推送，所以需要先生成一个<code>ACTIONS_DEPLOY_KEY</code>。</p><ol><li><p>生成密钥</p><pre><code class=language-shell># 执行后会生成gh-pages.pub 和 gh-pages
$ ssh-keygen -t rsa -b 4096 -C &quot;$(git config user.email)&quot; -f gh-pages -N &quot;&quot;
</code></pre></li><li><p>上传gh-pages.pub
点击博客仓库的Settings-&gt;Deploy keys-&gt;add deploy key，Title填写<code>ACTIONS_DEPLOY_KEY</code>，Key填写<code>gh-pages.pub</code>文件的内容。</p></li><li><p>上传gh-pages
点击博客仓库的Settings-&gt;Secrets-&gt;Add a new secret，Name填写<code>ACTIONS_DEPLOY_KEY</code>，Value填写<code>gh-pages</code>文件的内容。</p></li></ol><h2 id=配置-github-actions>配置 Github actions</h2><pre><code class=language-yml>name: github pages

on:
  push:
    branches:
    - master

jobs:
  build-deploy:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@master
      # with:
      #   submodules: true

    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2.2.2
      with:
        hugo-version: '0.58.3'
        # extended: true

    - name: Build
      run: hugo --minify

    - name: Deploy
      uses: peaceiris/actions-gh-pages@v2.5.0
      env:
        ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        PUBLISH_BRANCH: pages
        PUBLISH_DIR: ./public
</code></pre><p>以上配置会监听master分支的push事件，当有push时，进行hugo打包，并把打包结果推送到pages分支。</p><p>现在自动化编译已经完成了，服务器如何自动化部署呢？</p><p>其实很简单，只需使用linux crontab 功能自动更新就好，先把仓库clone到 <code>/var/www</code>下面，然后切换到pages分支，之后添加crontab自动更新。</p><pre><code class=language-shell>*/5 * * * * git -C /var/www/notes pull
</code></pre><p>经过这么一套配置，只需写md然后推送到远程就行了，哎，太懒了</p></div><img src=/images/qrcode.png width=300px style="margin:0 auto"><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://yanlong.me/post/nginx-static-build/><span class=button__text>Nginx 静态编译</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2019 Powered by <a href=https://yanlong.me>yanlong.me</a></span>
<span>:: Theme made by panr</span></div></div><div class=footer__inner><div class="copyright copyright--user"><span class=theme-info><a class=theme-link href=https://yuerblog.cc/ target=_blank>鱼儿的博客</a>
<span class=division>|</span>
<a class=theme-link href=http://www.is17.com/ target=_blank>依十七</a>
<span class=division>|</span>
<a class=theme-link href=https://zzrdark.github.io/ target=_blank>zzrdark的技术专栏</a>
<span class=division>|</span>
<a class=theme-link href=https://wujunze.com target=_blank>吴钧泽博客</a></span></div></div></footer><script src=https://yanlong.me/assets/main.js></script></div></body></html>